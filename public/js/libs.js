function vote_widget(){$.ajaxSetup({cache:!1}),$.ajax({url:"/ajax/vote/show",dataType:"json",success:function(e){if(1!=e.error){if($("#vote-header").html(e.vote.title),"close"==e.access){$html1='<div id="error-vote-msg"></div><form id="widget-form" method="post">',$html2=[];for(var t=0;t<e.vote.options.length;t++)1==e.vote.type?$html2[t]='<div class="checkbox-line"><input type="radio" name="vote_options" value="'+e.vote.options[t].id+'">'+e.vote.options[t].title+"</div>":$html2[t]='<div class="checkbox-line"><input type="checkbox" name="vote_options[]" value="'+e.vote.options[t].id+'">'+e.vote.options[t].title+"</div>";$html2=$html2.join(""),$html3='<input id="token-input" type="hidden" name="_csrf_token" value=""><input id="widget-vote-send" type="submit" value="Голосовать"></form>'}else if("open"==e.access){$html1='<div class="vote-result-bar"><div class="vote-result-name">ВСЕГО</div><div class="vote-result-info">'+e.count+'</div><div class="vote-result-percent"></div></div>',$html2=[];var s=e.count;for(t=0;t<e.sort_options.length;t++){if(0==s)var n=0;else n=100*e.sort_options[t].users.length/s;if(0!=e.count?percent=100*e.sort_options[t].users.length/e.count:percent=0,100!=percent)var i=percent.toFixed(1);else i=percent;$html2[t]='<div class="vote-option-result"><div class="vote-option-bar"><div class="vote-option-bar-name">'+e.sort_options[t].title+'</div><div class="vote-option-bar-info">'+e.sort_options[t].users.length+'</div><div class="vote-option-bar-percent">'+i+'%</div></div><div class="vote-progress-bar"><div class="progress-line" style="width: '+n+'%"></div></div></div>'}$html2=$html2.join(""),$html3=""}$("#vote-content").html($html1+$html2+$html3+"<br>")}}})}$(function(){$(".bbimg").on("click",function(){var e=$(this).attr("id"),t=$("textarea");if("post"==e)var s="post:",n="";else s="["+e+"]",n="[/"+e+"]";var i=t[0].selectionStart,o=t[0].selectionEnd,a=t.val(),l=t.val().substr(i,o-i),r=s+l+n,c=t.val().length,u=a.substr(0,i),v=a.substr(o,c);t.val(u+r+v);t.val().length;t.focus(),0==l.length?t[0].setSelectionRange(i+s.length,i+s.length):t[0].setSelectionRange(i,o+s.length+n.length)})}),$(function(){$(".quote").on("click",function(){var e=$(this).attr("id").substr(5),t="[quote author="+$(this).parent().parent().parent().children().children().html().trim()+" date="+$("#hidden-date-"+e).text().trim()+" post="+e+"]\n"+$("#hidden-message-"+e).text().trim()+"\n[/quote]\n\n",s=$("textarea"),n=s[0].selectionStart,i=s[0].selectionEnd,o=s.val(),a=o.substr(0,n),l=s.val().length,r=o.substr(i,l);return s.val(a+t+r),s.focus(),s[0].setSelectionRange(n+t.length,n+t.length),!1})}),$(function(){$(".headsmile").on("click",function(){$(".smilepanel").slideToggle(200)})}),$(function(){$(".smiles").on("click",function(){var e=$(this).attr("id"),t=$("textarea"),s=e,n=t[0].selectionStart,i=t[0].selectionEnd,o=t.val(),a=t.val().substr(n,i-n),l=s+a+"",r=t.val().length,c=o.substr(0,n),u=o.substr(i,r);t.val(c+l+u);t.val().length;t.focus(),0==a.length?t[0].setSelectionRange(n+s.length,n+s.length):t[0].setSelectionRange(n,i+s.length+"".length)})}),$(function(){$(".tumbler").on("click",function(){var e=$(this).attr("id"),t=e.substr(0,1),s=e.substr(1);$("#u"+s).html(""),$("#d"+s).html("");var n="id="+escape(s)+"&sign="+escape(t);$.ajaxSetup({cache:!1}),$.ajax({url:"/ajax/guestbook/rate",data:n,type:"POST",dataType:"json",success:function(e){1==e.error?alert(e.error_message):(0<e.message_rates?$("#l"+s).html("<span class='rate-high'>+"+e.message_rates+"</span>"):0==e.message_rates?$("#l"+s).html("<span class='rate-middle'>"+e.message_rates+"</span>"):e.message_rates<0&&$("#l"+s).html("<span class='rate-low'>"+e.message_rates+"</span>"),0<e.message_user?$(".r"+e.user).html("<div class='rate-high'><i class='fa fa-plus-circle' aria-hidden='true'></i> "+e.message_user+"</div>"):0==e.message_user?$(".r"+e.user).html("<div class='rate-middle'><i class='fa fa-circle' aria-hidden='true'></i> "+e.message_user+"</div>"):e.message_user<0&&$(".r"+e.user).html("<div class='rate-low'><i class='fa fa-minus-circle' aria-hidden='true'></i> "+Math.abs(e.message_user)+"</div>"))}})})}),$(function(){$("nav li").on("mouseenter",function(e){e.preventDefault(),$("ul.down-menu",this).css({display:"flex"})})}),$(function(){$("nav li").on("mouseleave",function(e){e.preventDefault(),$("ul.down-menu",this).css({display:"none"}).hide().slideUp()})}),$(function(){$("#add_option").on("click",function(){$(".vote-options > input").length;$(".vote-options").append('<input type="text" name="vote_options[]">')})}),$(function(){$("#remove_option").on("click",function(){2<$(".vote-options > input").length?$(".vote-options input:last").remove():alert("Должно быть минимум два варианта ответа")})}),$(document).ready(function(){vote_widget()}),$(document).ready(function(){$(document).on("submit","#widget-form",function(e){e.preventDefault();var t=$("#vote-content").attr("data-token");$("#token-input").val(t);var s=$("#widget-form").serialize();$.ajaxSetup({cache:!1}),$.ajax({url:"/ajax/vote/send",type:"POST",data:s,dataType:"json",success:function(e){e?$("#error-vote-msg").html(e):vote_widget()}})})});