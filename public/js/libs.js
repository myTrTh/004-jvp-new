$(function(){$(".admin-panel-users").on("click",function(){$(this).next().slideToggle(300)})}),$(function(){$('[id ^= "set-permissions"]').on("click",function(){var t=$(this).attr("id").substr(16),e=$("#form-per-"+t+' input[name="_csrf_token"]').val(),n=[];$("#form-per-"+t+" input:checkbox:checked").each(function(){n.push($(this).val())});var s="user="+encodeURIComponent(t)+"&permissions="+encodeURIComponent(n)+"&_csrf_token="+encodeURIComponent(e);$.ajaxSetup({cache:!1}),$.ajax({url:"/ajax/admin/permissions",data:s,type:"POST",dataType:"json",success:function(e){1==e.success?($(".error-pfield-"+t).html(""),$(".success-pfield-"+t).html(e.message)):($(".success-pfield-"+t).html(""),$(".error-pfield-"+t).html(e))}})})}),$(function(){$('[id ^= "set-roles"]').on("click",function(){var t=$(this).attr("id").substr(10),e=$("#form-rol-"+t+' input[name="_csrf_token"]').val(),n=[];$("#form-rol-"+t+" input:checkbox:checked").each(function(){n.push($(this).val())}),console.log(n);var s="user="+encodeURIComponent(t)+"&roles="+encodeURIComponent(n)+"&_csrf_token="+encodeURIComponent(e);$.ajaxSetup({cache:!1}),$.ajax({url:"/ajax/admin/roles",data:s,type:"POST",dataType:"json",success:function(e){1==e.success?($(".error-rfield-"+t).html(""),$(".success-rfield-"+t).html(e.message)):($(".success-rfield-"+t).html(""),$(".error-rfield-"+t).html(e))}})})}),$(function(){$(".bbimg").on("click",function(){var e=$(this).attr("id"),t=$("textarea");if("post"==e)var n="post:",s="";else n="["+e+"]",s="[/"+e+"]";var a=t[0].selectionStart,o=t[0].selectionEnd,i=t.val(),r=t.val().substr(a,o-a),l=n+r+s,c=t.val().length,u=i.substr(0,a),h=i.substr(o,c);t.val(u+l+h);t.val().length;t.focus(),0==r.length?t[0].setSelectionRange(a+n.length,a+n.length):t[0].setSelectionRange(a,o+n.length+s.length)})}),$(function(){$(".quote").on("click",function(){var e=$(this).attr("id").substr(5),t="[quote author="+$(this).parent().parent().parent().children().children().children().html().trim()+" date="+$("#hidden-date-"+e).text().trim()+" post="+e+"]\n"+$("#hidden-message-"+e).text().trim()+"\n[/quote]\n\n",n=$("textarea"),s=n[0].selectionStart,a=n[0].selectionEnd,o=n.val(),i=o.substr(0,s),r=n.val().length,l=o.substr(a,r);return n.val(i+t+l),n.focus(),n[0].setSelectionRange(s+t.length,s+t.length),!1})}),$(function(){$(".headsmile").on("click",function(){$(".smilepanel").slideToggle(200)})}),$(function(){$(".smiles").on("click",function(){var e=$(this).attr("id"),t=$("textarea"),n=e,s=t[0].selectionStart,a=t[0].selectionEnd,o=t.val(),i=t.val().substr(s,a-s),r=n+i+"",l=t.val().length,c=o.substr(0,s),u=o.substr(a,l);t.val(c+r+u);t.val().length;t.focus(),0==i.length?t[0].setSelectionRange(s+n.length,s+n.length):t[0].setSelectionRange(s,a+n.length+"".length)})}),$(function(){$(document).on("click",".spoiler-name",function(){var e=$(this).parent();e.next().slideToggle(300),"+"==$(".sign:first",e).html()?$(".sign:first",e).html("−"):$(".sign:first",e).html("+")})}),$(function(){$('div[id^="nach"]').on("mouseenter",function(e){e.preventDefault(),$(".toolkit",this).stop(!0,!1).slideDown(200)})}),$(function(){$('div[id^="nach"]').on("mouseleave",function(e){e.preventDefault(),$(".toolkit",this).stop(!0,!1).slideUp(200)})}),$(function(){$('div[id^="topnach"]').on("mouseenter",function(e){e.preventDefault(),$(".toptoolkit",this).stop(!0,!1).fadeIn(200)})}),$(function(){$('div[id^="topnach"]').on("mouseleave",function(e){e.preventDefault(),$(".toptoolkit",this).stop(!0,!1).fadeOut(200)})}),$(function(){$(".edit-post").on("click",function(){var e=$(this).attr("id").substr(4),t=$("#hidden-message-"+e).text().trim(),n=$("textarea"),s=n[0].selectionStart,a=n[0].selectionEnd,o=n.val(),i=(o.substr(0,s),n.val().length);o.substr(a,i);n.val(t),n.focus(),n[0].setSelectionRange(s+t.length,s+t.length),$("input:submit").val("Редактировать"),$("#guestbook-form").append("<input type='hidden' name='edit' value='"+e+"'>")})}),$(function(){$("nav li").on("mouseenter",function(e){e.preventDefault(),$("ul.down-menu",this).stop(!0,!1).css("display","flex")})}),$(function(){$("nav li").on("mouseleave",function(e){e.preventDefault(),$("ul.down-menu",this).stop(!0,!1).css("display","none")})}),$(function(){var e=(new Date).getTimezoneOffset()/60;document.cookie="timezone="+e+"; path=/"}),$(function(){$(".tumbler i").on("click",function(){var e=$(this).parent().attr("id"),t=e.substr(0,1),n=e.substr(1),s=$("#token").attr("data-token");$("#u"+n).html(""),$("#d"+n).html("");var a="id="+escape(n)+"&sign="+escape(t)+"&csrf_token="+escape(s);$.ajaxSetup({cache:!1}),$.ajax({url:"/ajax/guestbook/rate",data:a,type:"POST",dataType:"json",success:function(e){1==e.error?alert(e.error_message):(0<e.message_sum_rates?$("#l"+n).html("<span class='rate-high'>+"+e.message_sum_rates+"</span>"):0==e.message_sum_rates?$("#l"+n).html("<span class='rate-middle'>"+e.message_sum_rates+"</span>"):e.message_sum_rates<0&&$("#l"+n).html("<span class='rate-low'>"+e.message_sum_rates+"</span>"),0<e.author_sum_rates?$(".r"+e.user).html("<div class='rate-high'><i class='fa fa-plus-circle' aria-hidden='true'></i> "+e.author_sum_rates+"</div>"):0==e.author_sum_rates?$(".r"+e.user).html("<div class='rate-middle'><i class='fa fa-circle' aria-hidden='true'></i> "+e.author_sum_rates+"</div>"):e.author_sum_rates<0&&$(".r"+e.user).html("<div class='rate-low'><i class='fa fa-minus-circle' aria-hidden='true'></i> "+Math.abs(e.author_sum_rates)+"</div>"),$(".rate-users-up-"+n).html(e.plus_users),$(".rate-users-down-"+n).html(e.minus_users),$(".rate-users-no-"+n).html(""))}})})}),$(function(){$(".rate-level").on("mouseenter mouseleave",function(){var e=$(this).parent();$(".rate-panel-users",e).stop(!0,!1).slideToggle(400)})}),$(function(){$("#add_option").on("click",function(){$(".vote-options > input").length;$(".vote-options").append('<input type="text" name="vote_options[]">')})}),$(function(){$("#remove_option").on("click",function(){2<$(".vote-options > input").length?$(".vote-options input:last").remove():alert("Должно быть минимум два варианта ответа")})});